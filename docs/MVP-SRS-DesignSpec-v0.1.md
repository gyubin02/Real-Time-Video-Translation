# 실시간 영상 번역 데스크톱 앱 — MVP SRS + Design Spec (v0.1)

작성일: 2025-09-09 (Asia/Seoul)
역할: 시니어 시스템/플랫폼 아키텍트 & 기술 PM

---

## 0. 프로젝트 개요

* **제품명(가칭)**: 실시간 영상 번역 데스크톱 앱
* **목표**: 사용자의 **시스템 오디오**(예: 유튜브 영상 영어 오디오)를 실시간 수신 → **한국어 텍스트**로 번역 → **작은 오버레이/독립 창**에 자막 형태 출력
* **핵심 제약**: **번역은 반드시 GPT API**를 사용 (번역 품질·지연시간 최적화 포함)
* **대상 OS/플랫폼**: Windows 10+/11, macOS 13+ (x86-64/ARM64)
* **배포 형태**: 우선 **Electron (MVP)**, 이후 네이티브/Flutter Desktop 대안 평가
* **시간대/로캘**: Asia/Seoul, ko-KR

---

## 1. 문서 목적 및 범위

본 문서는 **MVP용 요구사항분석서(SRS)**와 **상세 설계서(Design Spec)**를 통합 제공한다. 범위는 실사용 가능한 최소 제품을 정의하고, 아키텍처·컴포넌트 설계·인터페이스·성능/보안·테스트 기준을 제시한다.

---

## 2. 용어 정의

* **시스템 오디오 캡처**: OS 출력 믹스(스피커)에 합성된 소리를 애플리케이션에서 수집하는 기능 (Win: WASAPI Loopback, macOS: 가상 오디오 디바이스 등)
* **VAD (Voice Activity Detection)**: 음성 구간 검출
* **ASR (Automatic Speech Recognition)**: 음성 → 원문 텍스트 변환
* **GPT 번역기**: GPT API를 사용한 **원문 → 한국어** 번역기 (스트리밍 지원)
* **Overlay Renderer**: 화면 최상단(always-on-top) 자막 오버레이 UI

---

## 3. 이해관계자 & 타겟 사용자

* **최종 사용자**: 유튜브/온라인 강의/웨비나 시청자, 영어 청취 보조 필요 사용자
* **운영/개발**: PM, 프론트엔드(Electron), 네이티브 모듈(오디오), ML/플랫폼 엔지니어, QA

---

## 4. 사용자 시나리오 (요약)

1. 사용자가 앱 실행 → “캡처 시작” 클릭 → 브라우저에서 유튜브 재생 → 앱 오버레이에 한국어 자막이 실시간 출력
2. 단축키(예: **Ctrl+Alt+T / ⌘+Ctrl+T**)로 캡처 시작/중지, **Ctrl+Alt+H** 오버레이 표시/숨김
3. 오류 발생(네트워크/레이트리밋) 시 상태 토스트 노출, 자동 재시도

---

## 5. 범위 (In/Out)

### In (MVP)

* 시스템 오디오 캡처(Win/macOS)
* 실시간 파이프라인: **캡처 → VAD/청크 → ASR → GPT 번역(필수) → 자막 렌더링**
* 오버레이 창(항상 위, 클릭 스루 토글, 폰트/크기/불투명도)
* 언어 설정(원문 auto/영어 고정), 한국어 출력 스타일 프리셋(존댓말/반말)
* 로컬 로그(개인정보 최소화), 즉시 신고용 디버그 패널

### Out (MVP 이후)

* 화자 분리/다국어 동시 처리, 용어집(글로서리) 학습/적용, 자막 파일 저장(.srt/.vtt), 유튜브 URL 직접 파싱, 모바일/리눅스, 계정/구독 결제, 사후 편집기

---

## 6. 기능 요구사항 (FR)

**FR-01 시스템 오디오 캡처**

* Win: WASAPI Loopback 사용, 출력 장치 변경 자동 추적
* macOS: 가상 오디오 디바이스(예: BlackHole/Loopback 등) 선택 가능 및 가이드 제공
* 캡처 샘플레이트(예: 16k/32k/48k)와 채널(모노/스테레오) 설정 제공

**FR-02 VAD & 청크러(Chunker)**

* 1.0–2.0s 단위 프레임, **50–200ms 오버랩**
* 무음/잡음 필터링, **링 버퍼 최대 30s** (메모리 누적 방지)
* 과도 길이 입력 방지를 위한 하드 컷(예: 10s 이상은 강제 분절)

**FR-03 ASR 처리**

* 옵션 A: 로컬 **faster-whisper**(가능 시), 옵션 B: **클라우드 ASR API**
* **부분(Partial) 결과** 스트리밍 수신 및 타임스탬프 포함
* 언어 자동 인식(영어 우선) 또는 사용자 고정 설정

**FR-04 GPT 번역(필수 제약)**

* **GPT API**로 영어→한국어 번역, **스트리밍 토큰** 수신
* 번역 스타일 프리셋: 존댓말/반말/직역/의역
* 숫자/전문용어/고유명사 보존 규칙 적용(프롬프트 템플릿 기반)

**FR-05 자막 렌더링**

* 항상 위 오버레이, **클릭 스루** 토글, 드래그 이동, 다중 모니터 지원
* 스타일: 폰트/크기/행간/배경(반투명)/최대 줄 수/열 제한(줄바꿈)
* **지터 버퍼(200–400ms)**로 화면 안정화, 타임스탬프 기반 스무딩

**FR-06 제어/설정**

* 장치 선택, 언어/스타일, 단축키, 성능(ASR 엔진 선택)
* 네트워크/레이트리밋 상태 표시, 오류 토스트, 재시도

**FR-07 로깅/진단**

* 로컬 순환 로그 파일(예: 10MB×3 롤링), PII 최소화
* “문제 보고” 시 최근 60초 기술 로그만 추출(사용자 동의)

**FR-08 설치/업데이트**

* Win: 설치형(NSIS/MSIX) + 자동 업데이트, macOS: DMG/서명/노터라이즈
* 첫 실행 가이드(오디오 라우팅 안내)

**FR-09 가용성/오프라인 처리**

* GPT 번역 의무로 **완전 오프라인은 미지원**
* 네트워크 단절 시 큐잉 및 재시도, 사용자 경고

**FR-10 보안/개인정보**

* 전송 구간 TLS, API 키 안전 저장(OS Keychain/Credential Manager)
* 음성/텍스트 **서버 비저장 기본값**(가능한 설정)

> 각 FR은 아래 **수용 기준(AC)**으로 검증.

---

## 7. 수용 기준 (예시)

* **AC-01**: 유튜브(영어) 재생 후 2초 내 첫 한국어 자막 토큰이 오버레이에 표시된다.
* **AC-02**: 장치 변경 시(이어폰 연결) 5초 이내 캡처 대체 장치를 자동 또는 프롬프트로 전환한다.
* **AC-03**: 10분 연속 재생 중 메모리 사용량이 선형 증가 없이 안정적으로 유지된다(누수/폭증 없음).
* **AC-04**: 네트워크 단절 상태에서 30초 내 3회 지수 백오프로 재시도하고 사용자에게 명확히 표시한다.
* **AC-05**: 단축키로 오버레이 표시/숨김/위치 이동이 즉시 반영된다.

---

## 8. 비기능 요구사항 (NFR)

**성능/지연 (NFR-P)**

* **E2E 1.0–2.0s 90p** 목표(오디오 입력~한국어 자막 가시화).
* 레이턴시 예산(권장):

  * 캡처+프리프로세싱: ≤150ms
  * ASR(부분 결과): ≤500–800ms
  * GPT 번역(스트리밍 첫 토큰): ≤300–600ms
  * 렌더링: ≤50ms
* CPU: 4코어 i5(8세대)/Apple M1 이상 권장, 메모리 ≤ 600MB (ASR 옵션에 따라 가변)

**안정성/회복 (NFR-R)**

* 크래시율 < 0.5%/세션, 자동 재시작(선택)
* 네트워크/레이트리밋 지수 백오프, 서킷 브레이커

**보안/개인정보 (NFR-S)**

* TLS(최신), 최소 권한 API 키 저장, 로그 PII 제외
* 사용자 동의 없는 클라우드 저장 금지

**호환성/배포 (NFR-D)**

* Windows 10/11, macOS 13+ 양호 동작
* 코드 서명, 자동 업데이트(사용자 승인)

**사용성/접근성 (NFR-U)**

* 폰트 크기 확대, 고대비 스킨, 한/영 단축키, 다중 모니터 인식

---

## 9. 아키텍처 개요

```
[System Audio] ──▶ [Capture (WASAPI/AVAudio)] ─▶ [VAD/Chunker (RingBuffer)]
                                        │
                                        ├─▶ [ASR Adapter (Local/Cloud)] ─▶ [ASR Partial/Final]
                                        │                                   (timestamps)
                                        └──────────────────────────────▶ [GPT Translator (stream)]
                                                                         │
                                                                         └─▶ [Subtitle Manager]
                                                                                │
                                                                                └─▶ [Overlay Renderer]
                                                                                      (AOT, click-through)
```

* **Electron Shell**: UI/설정/오버레이, Node 네이티브 애드온(오디오) 브리지
* **오디오 서비스**: OS별 캡처 드라이버, 리샘플/모노화, VAD, 청크/오버랩
* **ASR 어댑터**: Local(faster-whisper) 또는 Cloud ASR, 부분 결과 스트림
* **GPT 번역기**: 시스템 프롬프트 + 스타일 프리셋, 스트리밍 토큰
* **자막 매니저**: 타임스탬프 정렬, 지터 버퍼, 줄바꿈/줄 수 제한
* **오버레이 렌더러**: 투명, 항상 위, 클릭 스루 토글, 단축키

---

## 10. 시퀀스 (실시간 루프)

1. 캡처 서비스가 20ms 프레임으로 PCM 버퍼 수집
2. VAD로 음성 구간 탐지 → **1.5s 윈도우 / 150ms 스트라이드**로 청크 생성
3. ASR로 청크 전송(스트리밍) → **partial** 텍스트 + 타임스탬프 수신
4. partial을 **GPT 번역기로 즉시 파이프** (문장 경계 휴리스틱)
5. 번역 토큰 수신 즉시 오버레이 갱신(지터 버퍼로 깜빡임 완화)
6. final 확정 시 화면 텍스트 고정/정제(문장부호/띄어쓰기 재처리)

---

## 11. 컴포넌트 상세 설계

### 11.1 오디오 캡처/프리프로세싱

* **Windows**: WASAPI loopback, 공유 모드, 48kHz→16kHz 리샘플
* **macOS**: 가상 기기(설치 가이드 제공), AVAudioEngine Capture
* **메모리 보호**: **링 버퍼(최대 30s)**, 초기화 시 zero-fill, 누적 금지
* **VAD**: 에너지+주파수 기반 하이브리드, 노이즈 게이트, AGC(선택)

### 11.2 청크러(Chunker)

* 파라미터: window=1.5s, stride=0.15s, max_chunk=10s
* **Backpressure**: ASR 대기열 길이 상한, 초과 시 저우선순위 partial 폐기

### 11.3 ASR 어댑터

* **인터페이스**: `transcribe(stream: PCM) -> Partial/FinalResult{ text, t0,t1, confidence }`
* **에러**: 디바이스 분리, API 타임아웃, 모델 초기화 실패 → 재시도/폴백
* **선택**: 로컬(faster-whisper) or 클라우드 ASR. *번역은 항상 GPT.*

### 11.4 GPT 번역기

* **시스템 프롬프트(초안)**:

  * “영어 실시간 자막을 **자연스러운 한국어**로 번역하라. **숫자/고유명사/전문용어**는 보존. 문장 길이 과도 시 자연스레 분할. **존댓말/반말** 등 스타일 프리셋 준수. 부분 입력은 매끄럽게 보정.”
* **세션 컨텍스트**: 짧은 용어 캐시(최근 N개), 말줄임 보정 규칙
* **스트리밍**: 첫 토큰 지연 최소화, 레이트리밋 시 지수 백오프
* **포스트프로세싱**: 띄어쓰기/문장부호 교정, 줄 길이 래핑

### 11.5 자막 매니저 & 렌더러

* **지터 버퍼**: 200–400ms, partial→final 스무딩
* **레이아웃**: 최대 2줄, 줄바꿈(가변 폭), 배경 반투명, 모서리 라운드
* **컨트롤**: 단축키, 클릭 스루, 위치 스냅, 다중 모니터 기억

### 11.6 설정/상태

* 장치/언어/스타일/성능(ASR 타입), API 키 관리(OS Keychain)
* 상태 뱃지: **Capturing/ASR/GPT/RateLimit/Offline**

### 11.7 로깅/모니터링

* 레벨: INFO/WARN/ERROR, 성능 메트릭(E2E 지연, 토큰/초)
* 개인 데이터 제거 규칙, 버그리포트 패키저

---

## 12. 내부 이벤트 & 데이터 스키마 (초안)

```json
// AudioChunk
{
  "id": "uuid",
  "ts0": 1694255400.123, // unix sec
  "ts1": 1694255401.623,
  "sr": 16000,
  "samples": "<pcm-int16-bytes-base64>",
  "vad": true
}

// AsrResult (partial/final)
{
  "id": "uuid",
  "chunk_id": "uuid",
  "type": "partial|final",
  "text": "we observed...",
  "t0": 0.00,
  "t1": 1.50,
  "confidence": 0.86
}

// TranslationResult (stream)
{
  "id": "uuid",
  "asr_id": "uuid",
  "style": "honorific|casual|literal|free",
  "text": "우리는 관찰했다...",
  "partial": true
}
```

---

## 13. 상태 머신 (요약)

* **Idle → Capturing → Transcribing → Translating → Rendering → Capturing** (루프)
* **Fault** 분기: NetDown, RateLimited, DeviceLost → 알림 & 자동 복구

---

## 14. 오류/예외 처리 정책

* **네트워크**: 1s, 2s, 4s… 최대 30s 백오프, UI 배너 유지
* **레이트리밋**: 토큰/분 추적, 초과 시 큐 느리게 처리
* **메모리 폭증 방지**: 링 버퍼 상한, 청크 하드 컷, partial drop 정책
* **장치 분리**: 재탐색/재바인드, 실패 시 사용자 선택 프롬프트

---

## 15. 보안/개인정보 설계

* **전송**: TLS
* **보관**: 원시 오디오/텍스트 서버 비저장(기본), 로컬 로그 PII 제거
* **API 키**: Windows Credential Manager / macOS Keychain
* **옵트인**: 문제 보고 시에만 제한된 기술 로그 업로드(익명)

---

## 16. 배포/운영

* **Windows**: NSIS/MSIX, 자동 업데이트(Squirrel/AutoUpdater)
* **macOS**: Codesign/Notarization, DMG
* **사전체크**: macOS 오디오 라우팅 드라이버 설치 가이드
* **구성**: `.env`(개발) / OS Keychain(운영), 프록시 지원

---

## 17. 성능 목표 & 측정

* **목표**: E2E p90 ≤ 2.0s, p50 ≤ 1.2s
* **메트릭**: 캡처→ASR, ASR→GPT, GPT→렌더 각 구간 지연, 토큰/초, 드롭율
* **툴링**: 퍼포먼스 타임라인, 샘플 로그 인젝션, 합성 오디오 벤치

---

## 18. 테스트 전략 (요약)

* **단위**: VAD, 청크러, 타임스탬프 연산, 자막 줄바꿈
* **통합**: ASR 모의 서버, GPT 모의 스트림
* **시나리오**: 장치 전환, 네트워크 단절, 레이트리밋, 소음 환경
* **수동 QA 매트릭스**: Win10/11, macOS 13/14, 다양한 해상도/모니터

---

## 19. 설정 파라미터 (권장 기본값)

* 샘플레이트 16kHz, 모노, window=1.5s, stride=0.15s, jitter=300ms
* 번역 스타일=존댓말, 줄 수=2, 최대 열=42, 불투명도=0.6

---

## 20. 위험 요소 & 대응

* **macOS 캡처 난이도**: 가상 디바이스 설치 UX 개선(가이드/검출)
* **API 비용/레이트리밋**: 토큰 절약 프롬프트, 문장 경계 파이프라인, 캐시
* **지연 변동**: partial 우선 표시, 지터 버퍼, 백오프 정책
* **메모리 누수**: 링 버퍼 상한, 주기적 GC/버퍼 재사용

---

## 21. 로드맵 (MVP → v1.0)

* **MVP**: 기본 파이프라인, 오버레이, 단축키, 로그/리포트
* **0.9**: 사용자 글로서리, 번역 톤 세분화(방송/회의/수업), 자막 저장
* **1.0**: 발화자 구분(간이), URL 핸들링, 프리미엄 모델 선택, 자동 업데이트 안정화

---

## 22. 라이선스/서드파티

* Electron, 오디오 캡처 네이티브 모듈, (선택) faster-whisper
* macOS 가상 오디오 드라이버(서드파티 라이선스 주의)

---

## 23. 부록

### 23.1 GPT 번역 프롬프트 템플릿(초안)

```
[system]
You are a real-time subtitle translator. Translate English ASR fragments into NATURAL Korean.
Rules: preserve numbers/proper nouns; smooth partials; keep lines concise (<=42 chars), 2 lines; style=${STYLE} (honorific|casual|literal|free).

[user]
<ENGLISH_PARTIAL>
```

### 23.2 단축키(기본)

* 시작/중지: Ctrl+Alt+T (mac: ⌘+Ctrl+T)
* 오버레이 표시/숨김: Ctrl+Alt+H
* 클릭 스루 토글: Ctrl+Alt+C

### 23.3 로그 예시

```
[12:03:11.234] capture: chunk 1.50s (vad=1)  
[12:03:11.410] asr: partial t0=10.0 t1=11.5 conf=0.84  
[12:03:11.720] gpt: tok/s=18, first_token=290ms  
[12:03:11.821] overlay: update (partial)
```

